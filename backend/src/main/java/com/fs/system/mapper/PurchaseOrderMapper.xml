<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fs.system.mapper.PurchaseOrderMapper">

    <resultMap id="PurchaseOrderResultMap" type="com.fs.system.entity.PurchaseOrder">
        <id property="id" column="id"/>
        <result property="orderNo" column="order_no"/>
        <result property="supplierId" column="supplier_id"/>
        <result property="orderDate" column="order_date"/>
        <result property="totalAmount" column="total_amount"/>
        <result property="taxAmount" column="tax_amount"/>
        <result property="discountAmount" column="discount_amount"/>
        <result property="finalAmount" column="final_amount"/>
        <result property="status" column="status"/>
        <result property="paymentMethod" column="payment_method"/>
        <result property="paymentDate" column="payment_date"/>
        <result property="isPosted" column="is_posted"/>
        <result property="postedAt" column="posted_at"/>
        <result property="remark" column="remark"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <select id="selectAll" resultMap="PurchaseOrderResultMap">
        SELECT * FROM biz_purchase_order ORDER BY id DESC
    </select>

    <select id="selectById" resultMap="PurchaseOrderResultMap">
        SELECT * FROM biz_purchase_order WHERE id = #{id}
    </select>

    <select id="selectUnposted" resultMap="PurchaseOrderResultMap">
        SELECT * FROM biz_purchase_order 
        WHERE is_posted = 0 AND status IN ('Confirmed', 'Received', 'Paid')
        ORDER BY order_date DESC
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO biz_purchase_order (order_no, supplier_id, order_date, total_amount, tax_amount,
        discount_amount, final_amount, status, payment_method, payment_date, is_posted, remark)
        VALUES (#{orderNo}, #{supplierId}, #{orderDate}, #{totalAmount}, #{taxAmount},
        #{discountAmount}, #{finalAmount}, #{status}, #{paymentMethod}, #{paymentDate}, #{isPosted}, #{remark})
    </insert>

    <update id="update">
        UPDATE biz_purchase_order SET
        order_no = #{orderNo},
        supplier_id = #{supplierId},
        order_date = #{orderDate},
        total_amount = #{totalAmount},
        tax_amount = #{taxAmount},
        discount_amount = #{discountAmount},
        final_amount = #{finalAmount},
        status = #{status},
        payment_method = #{paymentMethod},
        payment_date = #{paymentDate},
        is_posted = #{isPosted},
        remark = #{remark}
        WHERE id = #{id}
    </update>

    <update id="markAsPosted">
        UPDATE biz_purchase_order SET is_posted = 1, posted_at = NOW() WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM biz_purchase_order WHERE id = #{id}
    </delete>

</mapper>

